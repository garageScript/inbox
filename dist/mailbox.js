(()=>{var e={290:()=>{const e=document.getElementById("container-accounts"),t=document.getElementById("container-mails");let n,a={};const c=c=>{const r=document.createElement("h3");e.append(r),r.classList.add("cursor","tag"),r.innerText=c.split("@")[0];const i=document.createElement("div");fetch(`/api/unreadNo/${c}`).then((e=>e.json())).then((e=>{e&&(i.classList.add("numberBall"),i.innerText=e,r.append(i))})),r.addEventListener("click",(()=>{if(r.classList.contains("clicked"))return;if(n)return;n=!0,document.querySelectorAll(".clicked").forEach((e=>{e.classList.remove("clicked"),e.classList.add("cursor")})),r.classList.add("clicked"),r.classList.remove("cursor"),t.style.top=0-t.offsetHeight+"px",t.classList.add("clipped");const e=()=>{const e=a[c];document.querySelectorAll(".mailcard").forEach((e=>e.remove())),e.forEach(((t,n)=>{e[n].mailcard=s(n,c,{head:r,number:i})})),t.style.top=0-t.offsetHeight+"px",setTimeout((()=>{t.style.top=0,t.classList.remove("clipped"),n=!1}),140)};setTimeout((()=>{if(!a[c])return fetch(`/api/mails/${c}`).then((e=>e.json())).then((t=>{a[c]=t,e()}));e()}),140)}))},r=(e,t,n)=>{const a=document.createElement("div");a.classList.add("hide","text");const c=document.createElement("div");c.classList.add("attachmentBox"),a.append(c),n&&n.forEach((e=>{const t=document.createElement("div");let n;t.innerHTML='<i class="fas fa-file"></i>&nbsp;&nbsp;'+e.filename,t.classList.add("attachment","cursor"),c.append(t),t.addEventListener("click",(()=>{n?n.click():fetch(`/api/attachment/${e.content.data}`).then((e=>e.arrayBuffer())).then((t=>{n=document.createElement("a");const a=new Blob([t],{type:e.contentType}),c=URL.createObjectURL(a);n.href=c,n.target="_black",n.download=e.filename,n.click()}))}))}));const r=document.createElement("iframe");return r.srcdoc=`\n  <style>\n    body {\n      margin: 0;\n      overflow-y: hidden;\n    }\n    * {\n      font-family: 'Open Sans';\n      color: rgb(70,70,70);\n    }\n  </style>\n  ${t}\n  <link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700&amp;subset=latin" rel="stylesheet">\n  `,r.style.height=0,a.append(r),e.append(a),new Promise(((e,t)=>{r.addEventListener("load",(()=>{e(a)}))}))},s=(e,n,c)=>{const s=a[n][e];if(s.mailcard)return t.prepend(s.mailcard),s.mailcard;const i=document.createElement("blockquote");i.classList.add("mailcard"),s.read||i.classList.add("unread"),t.prepend(i);const l=document.createElement("div");i.append(l);const d=document.createElement("div");d.classList.add("header","cursor");const o=new Date(s.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),m=new Date(s.date).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});let u=(Number(Date.now())-Number(new Date(s.date)))/6e4;u=u>2880?`${Math.floor(u/1440)} days ago`:u>120?`${Math.floor(u/60)} hours ago`:u>2?`${Math.floor(u)} minutes ago`:"just now",d.innerHTML=`\n    <div class="mailcard-small content">${u}</div>\n    <div class="mailcard-small content">${o}, ${m}</div>\n    <div class="mailcard-small content">${s.from.text.replace("<","&lt;").replace(">","&gt;")}</div>\n    <div class="mailcard-subject content">${s.subject}</div>\n  `,l.append(d);const h=e=>{if(e.classList.contains("hide")){s.read||(fetch(`/api/markRead/${s.id}`),s.read=!0,i.classList.remove("unread"),c.number.innerText-=1,"0"===c.number.innerText&&c.number.remove());const t=Array.from(document.querySelectorAll(".text")).filter((e=>!e.classList.contains("hide")));t.forEach((t=>{t!==e&&(t.children[1].style.height=0,setTimeout((()=>{t.classList.add("hide")}),130))}));const n=t.length?130:0;setTimeout((()=>{e.classList.remove("hide"),e.children[1].style.height=e.children[1].contentWindow.document.body.scrollHeight+32+"px"}),n)}else e.children[1].style.height=0,setTimeout((()=>{e.classList.add("hide")}),130)};d.addEventListener("click",(()=>{s.text?s.text.parentElement?h(s.text):(i.append(s.text),s.text.children[1].addEventListener("load",(()=>{h(s.text)}))):fetch(`/api/mailContent/${s.id}`).then((e=>e.json())).then((e=>(s.html=e.html,s.messageId=e.messageId,r(i,e.html,e.attachments)))).then((e=>{s.text=e,h(s.text)}))}));const p=document.createElement("div");p.classList.add("actionBox"),l.prepend(p);const g=document.createElement("div");g.classList.add("iconBox");const f=document.createElement("i");f.classList.add("fas","fa-trash","cursor"),g.prepend(f),p.prepend(g),f.addEventListener("click",(()=>{event.stopPropagation(),confirm("Do you want to delete this mail?")&&fetch(`/api/mails/${s.id}`,{method:"DELETE"}).then((e=>{i.remove(),document.querySelectorAll(".mailcard").length||c.head.remove()}))}));const y=document.createElement("div");y.classList.add("iconBox");const v=document.createElement("i");return v.classList.add("fas","fa-reply","cursor"),y.prepend(v),p.prepend(y),v.addEventListener("click",(()=>{if(writerContent.classList.remove("flip"),document.getElementById("writer-from").value=n.split("@")[0],document.getElementById("writer-to").value=s.from.value[0].address,document.getElementById("writer-cc").value=s.cc?.value.reduce(((e,t,n)=>e?e+", "+t.address:t.address),"")||"",document.getElementById("writer-title").value="RE: "+s.subject,s.text){const e=new Date(s.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),t=new Date(s.date).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),n=`\n        \n\n\n\n        <in-reply-to>${s.messageId}<in-reply-to>\n        <br><br><br>\n        <p>On ${e} at ${t}, ${s.from.text.replace("<","&lt;").replace(">","&gt;")} wrote:</p>\n        <blockquote style="border-left: 1px solid #cccccc; padding-left: 0.5rem; margin-left: 0.5rem">\n          ${s.html}\n        </blockquote>\n      `;document.getElementById("writer-textarea").value=n}else fetch(`/api/mailContent/${s.id}`).then((e=>e.json())).then((e=>{s.html=e.html,s.messageId=e.messageId;const t=new Date(s.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),n=new Date(s.date).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),a=`\n          \n\n\n\n          <in-reply-to>${s.messageId}<in-reply-to>\n          <br><br><br>\n          <p>On ${t} at ${n}, ${s.from.text.replace("<","&lt;").replace(">","&gt;")} wrote:</p>\n          <blockquote style="border-left: 1px solid #cccccc; padding-left: 0.5rem; margin-left: 0.5rem">\n            ${s.html}\n          </blockquote>\n        `;return document.getElementById("writer-textarea").value=a,r(i,e.html,e.attachments)})).then((e=>{s.text=e}));writerIsShown||toggleWriter()})),i};let i;i||(i=!0,a={},document.querySelectorAll(".tag").forEach((e=>e.remove())),document.querySelectorAll(".mailcard").forEach((e=>e.remove())),fetch("/api/accounts").then((e=>e.json())).then((e=>e.forEach(c))).then((()=>{i=!1})))},482:()=>{const e=document.getElementById("writer-cc"),t=document.getElementById("writer-bcc"),n=document.getElementById("writer-eye");n.addEventListener("click",(()=>{e.classList.toggle("hide"),e.disabled=!e.disabled,t.classList.toggle("hide"),t.disabled=!t.disabled,n.classList.toggle("fa-eye"),n.classList.toggle("fa-times")})),document.getElementById("writer-paperclip").addEventListener("click",(()=>{const e=document.createElement("input");e.setAttribute("type","file"),e.multiple=!0,e.click(),e.addEventListener("change",(()=>{Array.from(e.files).forEach((async(e,t)=>{cache.writer||(cache.writer={attachments:{}});const n=`${Date.now()}-${t}`;cache.writer.attachments[n]=e;let a=document.querySelector("#writer-body > .attachmentBox");a||(a=document.createElement("div"),a.classList.add("attachmentBox"),document.getElementById("writer-body").prepend(a));const c=document.createElement("div");c.classList.add("attachment");const r=document.createElement("div");r.innerHTML='<i class="fas fa-file"></i>&nbsp;&nbsp;'+e.name,r.classList.add("attachment-text","cursor");const s=await(i=e,new Promise((e=>{const t=new FileReader;t.readAsDataURL(i),t.addEventListener("load",(()=>{e(t.result)}),!1)})));var i;const l=document.createElement("iframe");l.classList.add("attachment-preview","clipped"),e.type.includes("image")?l.srcdoc=`<img src="${s}" width="100%"/>`:e.type?l.src=s:e.text().then((e=>{l.srcdoc=`<div>${e}</div>`})),c.append(l),c.append(r),c.addEventListener("mouseover",(()=>{l.classList.remove("clipped")})),c.addEventListener("mouseleave",(()=>{l.classList.add("clipped")})),c.addEventListener("click",(()=>{l.classList.add("clipped"),r.style.width=r.offsetWidth+"px",r.style.height=r.offsetHeight+"px",r.style.width=0,delete cache.writer.attachments[n],setTimeout((()=>{c.remove()}),150)})),c.setAttribute("title","Click to remove"),a.append(c)}))}))})),document.getElementById("writer-send").addEventListener("click",(async()=>{if(!confirm("Do you want to send it?"))return;const n=new FormData,r=document.getElementById("writer-name").value,s=document.getElementById("writer-from").value,i=document.getElementById("writer-to").value,l=e.classList.contains("hide")?null:e.value,d=t.classList.contains("hide")?null:t.value,o=document.getElementById("writer-title").value,{html:m,inReplyTo:h}=a(document.getElementById("writer-textarea").value),p={name:r,sender:s,to:i,cc:l,bcc:d,subject:o,html:m,inReplyTo:h};Object.keys(p).forEach((e=>{n.append(e,p[e])}));const g=cache.writer&&Object.values(cache.writer.attachments);g?.length&&g.forEach((e=>{n.append("attachments",e)})),'"done"'===await fetch("/api/send",{method:"POST",headers:{},body:n}).then((e=>e.text()))?(alert("Your mail is sent successfully"),document.querySelectorAll("input, textarea").forEach((e=>{e.value=""})),document.querySelector("#writer-body > .attachmentBox").innerHTML="",cache.writer=null,u(),c.classList.remove("flip")):alert("Email delivery has failed. Please try again.")}));const a=e=>{const t=e.split("<in-reply-to>");return{html:marked(t[0])+(t[2]||""),inReplyTo:t[1]}},c=document.getElementById("writer-content"),r=document.getElementById("writer-preview");let s;document.getElementById("writer-previewBtn").addEventListener("click",(()=>{if(s)return;if(s=!0,c.classList.toggle("flip"),setTimeout((()=>{r.classList.toggle("hide")}),150),setTimeout((()=>{s=!1}),600),!c.classList.contains("flip"))return;const{html:e}=a(document.getElementById("writer-textarea").value);document.getElementById("writer-preview").srcdoc=`\n      <style>\n        body {\n          margin: 0;\n        }\n        * {\n          font-family: 'Open Sans';\n          color: rgb(70,70,70);\n        }\n      </style>\n      ${e}\n      <link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700&amp;subset=latin" rel="stylesheet">\n    `}));const i=document.getElementById("writer-textarea"),l=document.getElementById("writer-content-wrap");new ResizeObserver((e=>{l.style.height=e[0].target.style.height})).observe(i);const d=document.getElementById("container-writer"),o=document.getElementById("title_bar");let m;container.style.top=-16+o.offsetHeight-d.offsetHeight+"px";const u=()=>{c.classList.remove("flip"),m?(m=!1,container.style.top=-16+o.offsetHeight-d.offsetHeight+"px",d.classList.add("clipped")):(m=!0,d.classList.remove("clipped"),container.style.top=4+o.offsetHeight+"px")};document.getElementById("write").addEventListener("click",u)}},t={};function n(a){var c=t[a];if(void 0!==c)return c.exports;var r=t[a]={exports:{}};return e[a](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";n(482),n(290),document.getElementById("logout").addEventListener("click",(()=>{fetch("/admin",{method:"DELETE"}).then((e=>{location.href="/"}))})),document.getElementById("refresh").addEventListener("click",(()=>{getMails()}))})()})();